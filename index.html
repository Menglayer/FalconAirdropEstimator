<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Falcon Airdrop Estimator</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="alternate icon" type="image/png" href="favicon.png">
  <meta name="theme-color" content="#357ef3">
  <style>
:root{ --bg1:#eef6ff; --bg2:#ffffff; --brand:#357ef3; --brand-dark:#2b66cc; --text:#0f172a; --muted:#64748b; --border:#e5e7eb; --card: rgba(255,255,255,0.85); --shadow: 0 8px 30px rgba(53,126,243,.12); }
*{box-sizing:border-box} html,body{height:100%}
body{ margin:0; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif; color:var(--text); background: linear-gradient(to bottom, var(--bg1), var(--bg2));}
.container{max-width:1200px; margin:0 auto; padding:24px}
h1{margin:12px 0 0; font-size:40px; line-height:1.2}
.row{display:grid; grid-template-columns:1fr; gap:20px}
@media(min-width:1024px){.row{grid-template-columns:repeat(3, 1fr)}}
.card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:20px; box-shadow:var(--shadow)}
.label{display:block; font-size:12px; color:var(--muted)}
.input{margin-top:6px; width:100%; border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-variant-numeric:tabular-nums; font-size:14px}
.btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:8px 12px; border-radius:10px; background:var(--brand); color:#fff; border:0; cursor:pointer; font-size:13px; min-height:34px; line-height:1}
.grid4{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:20px}
.kpi-title{font-size:13px; color:var(--muted)}
.kpi-value{margin-top:8px; font-size:28px; font-weight:700; font-variant-numeric:tabular-nums}
.notice{font-size:12px; color:var(--muted)}
.header{display:flex; justify-content:space-between; align-items:flex-start; gap:20px}
.header-panel{min-width:320px}
.hero{position:relative; overflow:visible; background:
  radial-gradient(60% 50% at 90% 0%, rgba(80,158,255,.20), transparent 70%),
  radial-gradient(50% 40% at 10% 20%, rgba(37,80,255,.12), transparent 70%);
}
.hero .inner{position:relative; z-index:1}
.footer{margin:24px auto; text-align:center; font-size:12px; color:var(--muted)}
.footer a{color:#2563eb; text-decoration:none}
  </style>
</head>
<body>
  <div class="hero">
    <div class="container inner">
      <div class="header">
        <div>
          <h1 id="titleH1" data-i18n-html="title">预估你的 <span style="color:#2b66cc">$Falcon</span> 空投价值</h1>
        </div>
        <div class="card header-panel">
          <div class="label" data-i18n="top100Label">Top100 当前合计</div>
          <div id="top100Sum" class="kpi-value">—</div>
          <div id="top100Status" class="notice">尚未请求</div>
          <div class="notice" style="margin-top:6px">
            <span data-i18n="calcNowPrefix">按占比 </span>
            <span id="shareLabel">70</span>
            <span data-i18n="calcNowMiddle">% 推算全网当前：</span>
            <span id="totalNow" style="font-weight:600" class="num">—</span>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px">
            <button id="langToggle" class="btn" title="中/EN">中 / EN</button>
            <button id="refreshBtn" class="btn" data-i18n="refresh">刷新 Top100</button>
            <button id="exportCsvBtn" class="btn" data-i18n="exportCsv">导出 CSV</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row" style="margin-top:20px">
      <div class="card">
        <div class="kpi-title" style="font-weight:600; color:#0f172a" data-i18n="myParams">我的参数</div>
        <div style="margin-top:16px; display:flex; flex-direction:column; gap:14px">
          <label class="label"><span data-i18n="curMiles">当前 Miles</span>
            <input id="currentMiles" class="input" inputmode="decimal" placeholder="例如 123456">
          </label>
          <label class="label"><span data-i18n="dailyMiles">当前 每日 Miles</span>
            <input id="myDailyMiles" class="input" inputmode="decimal" placeholder="例如 800">
          </label>
        </div>
      </div>

      <div class="card">
        <div class="kpi-title" style="font-weight:600; color:#0f172a" data-i18n="netAssump">全网与假设</div>
        <div style="margin-top:16px; display:flex; flex-direction:column; gap:14px">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
            <label class="label"><span data-i18n="sharePct">Top100 占比（%）</span>
              <input id="topShare" class="input" inputmode="decimal" value="70">
            </label>
            <label class="label"><span data-i18n="growthPct">每日增速（%）</span>
              <input id="growthPct" class="input" inputmode="decimal" value="1.3">
            </label>
          </div>
          <label class="label"><span data-i18n="fdv">TGE 时 FDV</span>
            <input id="fdv" class="input" inputmode="decimal" value="1,000,000,000">
          </label>
          <label class="label"><span data-i18n="airdropPct">TGE 时空投比例（%）</span>
            <input id="airdropPct" class="input" inputmode="decimal" value="8">
          </label>
          <label class="label"><span data-i18n="netDaily">（可选）全网当前每日新增 Miles</span>
            <input id="netDailyMilesNow" class="input" inputmode="decimal" placeholder="若未知可留空或 0">
          </label>
        </div>
      </div>

      <div class="card">
        <div class="kpi-title" style="font-weight:600; color:#0f172a" data-i18n="timeData">时间与数据</div>
        <div style="margin-top:16px; display:flex; flex-direction:column; gap:14px">
          <label class="label"><span data-i18n="tgeDate">TGE 日期</span>
            <input id="tgeDate" type="date" class="input">
          </label>
          <div class="notice"><span data-i18n="daysToTge">距离今天：</span><span id="daysToTgeNum">—</span><span data-i18n="daysSuffix"> 天</span></div>
          <div class="notice" style="border:1px dashed var(--border); border-radius:12px; padding:10px; background:rgba(255,255,255,.7)" data-i18n="note">说明：未填“全网每日新增”时，按总量×每日增速，做线性累计；填了则按每日新增做线性累计。</div>
        </div>
      </div>
    </div>

    <div class="grid4" style="margin-top:20px">
      <div class="card">
        <div class="kpi-title" data-i18n="oneM">1M MILES 的预测价值</div>
        <div id="oneMMilesValue" class="kpi-value">—</div>
      </div>
      <div class="card">
        <div class="kpi-title" data-i18n="myAtTge">TGE 我的累计 Miles</div>
        <div id="myMilesAtTGE" class="kpi-value">—</div>
      </div>
      <div class="card">
        <div class="kpi-title" data-i18n="netAtTge">预测全网累计（TGE）</div>
        <div id="T_pred" class="kpi-value">—</div>
        <div class="notice" data-i18n="netAtTgeNote">会随“Top100 占比”与“每日增速”联动</div>
      </div>
      <div class="card">
        <div class="kpi-title" data-i18n="airdropCard">空投价值 / 我的占比</div>
        <div id="myAirdropValue" class="kpi-value">？</div>
        <div id="sharePct" class="notice" data-i18n="gateHint">（点击“分析”跳转后可见）</div>
        <div id="gateArea" class="notice" style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; align-items:center">
          <button id="analyzeBtn" class="btn" data-i18n="analyze">分析</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>made by　<a href="https://x.com/MengLyaer" target="_blank">X：@MengLyaer</a>　<a href="https://t.me/menglayer" target="_blank">Tg：@menglayer</a></div>
      <div style="margin-top:6px">Falcon Refer Link：<a href="https://app.falcon.finance?r=04f86cd7b3e33df15cec49169d80ed71" target="_blank">15% Miles Boost</a></div>
    </div>
  </div>

<script>
(function(){
  // helpers
  function $(sel){ return document.querySelector(sel); }
  function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }
  function fmt(n, d){ if(n==null || !isFinite(n)) return '—'; return new Intl.NumberFormat('en-US',{maximumFractionDigits:(d==null?2:d)}).format(n); }
  function parseNum(v, def){ var n = parseFloat(String(v||'').replace(/,/g,'')); return isFinite(n)?n:(def==null?0:def); }
  function geomSum(a0,g,n){ if(n<=0) return 0; if(g===0) return a0*n; return a0*(Math.pow(1+g,n)-1)/g; }
  function daysBetween(a,b){ var d1=new Date(a.getFullYear(),a.getMonth(),a.getDate()); var d2=new Date(b.getFullYear(),b.getMonth(),b.getDate()); return Math.max(0, Math.round((d2-d1)/86400000)); }
  function setText(node, val){ if(node){ node.textContent = val; } }

  // elements
  var el = {
    top100Sum: $('#top100Sum'),
    top100Status: $('#top100Status'),
    totalNow: $('#totalNow'),
    langToggle: $('#langToggle'),
    refreshBtn: $('#refreshBtn'),
    exportCsvBtn: $('#exportCsvBtn'),
    shareLabel: $('#shareLabel'),
    topShare: $('#topShare'),
    growthPct: $('#growthPct'),
    fdv: $('#fdv'),
    airdropPct: $('#airdropPct'),
    netDailyMilesNow: $('#netDailyMilesNow'),
    currentMiles: $('#currentMiles'),
    myDailyMiles: $('#myDailyMiles'),
    tgeDate: $('#tgeDate'),
    daysToTgeNum: $('#daysToTgeNum'),
    myMilesAtTGE: $('#myMilesAtTGE'),
    T_pred: $('#T_pred'),
    myAirdropValue: $('#myAirdropValue'),
    sharePct: $('#sharePct'),
    oneMMilesValue: $('#oneMMilesValue'),
    analyzeBtn: $('#analyzeBtn')
  };

  // i18n
  var lang = 'zh';
  var i18n = {
    zh: {
      title: '预估你的 <span style="color:#2b66cc">$Falcon</span> 空投价值',
      top100Label: 'Top100 当前合计',
      statusIdle: '尚未请求',
      statusLoading: '请求中...',
      statusUpdated: '已更新',
      calcNowPrefix: '按占比 ',
      calcNowMiddle: '% 推算全网当前：',
      refresh: '刷新 Top100',
      exportCsv: '导出 CSV',
      myParams: '我的参数',
      curMiles: '当前 Miles',
      dailyMiles: '当前 每日 Miles',
      netAssump: '全网与假设',
      sharePct: 'Top100 占比（%）',
      growthPct: '每日增速（%）',
      fdv: 'TGE 时 FDV',
      airdropPct: 'TGE 时空投比例（%）',
      netDaily: '（可选）全网当前每日新增 Miles',
      timeData: '时间与数据',
      tgeDate: 'TGE 日期',
      daysToTge: '距离今天：',
      daysSuffix: ' 天',
      // ✅ 说明改为线性累计
      note: '说明：未填“全网每日新增”时，按总量×每日增速，做线性累计；填了则按每日新增做线性累计。',
      oneM: '1M MILES 的预测价值',
      myAtTge: 'TGE 我的累计 Miles',
      netAtTge: '预测全网累计（TGE）',
      netAtTgeNote: '会随“Top100 占比”与“每日增速”联动',
      airdropCard: '空投价值 / 我的占比',
      gateHint: '（点击“分析”跳转后可见）',
      analyze: '分析',
      phCur: '例如 123456',
      phDaily: '例如 800',
      phNetDaily: '若未知可留空或 0'
    },
    en: {
      title: 'Estimate your <span style="color:#2b66cc">$Falcon</span> airdrop value',
      top100Label: 'Top100 Total (current)',
      statusIdle: 'Idle',
      statusLoading: 'Loading...',
      statusUpdated: 'Updated',
      calcNowPrefix: 'Using share ',
      calcNowMiddle: '% → Estimated network now: ',
      refresh: 'Refresh Top100',
      exportCsv: 'Export CSV',
      myParams: 'My Inputs',
      curMiles: 'Current Miles',
      dailyMiles: 'Daily Miles',
      netAssump: 'Network & Assumptions',
      sharePct: 'Top100 Share (%)',
      growthPct: 'Daily Growth (%)',
      fdv: 'FDV at TGE',
      airdropPct: 'Airdrop % at TGE',
      netDaily: '(Optional) Network Daily Miles (now)',
      timeData: 'Time & Date',
      tgeDate: 'TGE Date',
      daysToTge: 'Days from today: ',
      daysSuffix: '',
      // ✅ Linear wording
      note: 'Note: If network daily is empty, total grows linearly by (current total × daily growth); otherwise it grows linearly by the provided daily addition.',
      oneM: 'Predicted value of 1M MILES',
      myAtTge: 'My cumulative Miles at TGE',
      netAtTge: 'Predicted Network Total (TGE)',
      netAtTgeNote: 'Linked to Top100 share and daily growth',
      airdropCard: 'Airdrop Value / My Share',
      gateHint: '(Visible after clicking "Analyze")',
      analyze: 'Analyze',
      phCur: 'e.g. 123456',
      phDaily: 'e.g. 800',
      phNetDaily: '(leave empty or 0 if unknown)'
    }
  };

  function applyI18n(){
    var dict = i18n[lang];
    $all('[data-i18n]').forEach(function(n){ var k=n.getAttribute('data-i18n'); if(n.id==='top100Status') return; if(dict[k]!=null) n.textContent=dict[k]; });
    $all('[data-i18n-html]').forEach(function(n){ var k=n.getAttribute('data-i18n-html'); if(dict[k]!=null) n.innerHTML=dict[k]; });
    var prefix=dict.calcNowPrefix, middle=dict.calcNowMiddle;
    var share=el.shareLabel.textContent||'—'; var tn=el.totalNow.textContent||'—';
    var notice=el.totalNow.parentNode;
    notice.innerHTML = prefix + '<span id="shareLabel">'+share+'</span>' + middle + '<span id="totalNow" style="font-weight:600" class="num">'+tn+'</span>';
    el.shareLabel=document.getElementById('shareLabel'); el.totalNow=document.getElementById('totalNow');
    if (el.langToggle) el.langToggle.textContent = (lang==='zh')?'中 / EN':'EN / 中';
    if (el.currentMiles) el.currentMiles.setAttribute('placeholder', dict.phCur);
    if (el.myDailyMiles) el.myDailyMiles.setAttribute('placeholder', dict.phDaily);
    if (el.netDailyMilesNow) el.netDailyMilesNow.setAttribute('placeholder', dict.phNetDaily);
  }

  // logic
  var today=new Date(); document.getElementById('tgeDate').value='2025-10-15'; window._resultUnlocked=false;

  function httpGetJson(url, ok, err){
    try{ var xhr=new XMLHttpRequest(); xhr.open('GET',url,true); xhr.setRequestHeader('Cache-Control','no-cache');
      xhr.onreadystatechange=function(){ if(xhr.readyState===4){ if(xhr.status>=200 && xhr.status<300){ try{ ok(JSON.parse(xhr.responseText)); }catch(e){ err(e); } } else err(new Error('HTTP '+xhr.status)); } };
      xhr.send(); }catch(e){ err(e); }
  }

  function fetchTop100(){
    setText(el.top100Status, i18n[lang].statusLoading); setText(el.top100Sum, '—');
    var url='https://api.falcon.finance/api/v1/points/leaderboard?ts='+(new Date().getTime());
    httpGetJson(url, function(data){
      var list=(data && data.leaderboard && data.leaderboard.splice?data.leaderboard:[]);
      var sum=0; for(var i=0;i<Math.min(100,list.length);i++){ var v=parseFloat(list[i]&&list[i].points||'0'); if(isFinite(v)) sum+=v; }
      el.top100Sum.setAttribute('data-raw', String(sum));
      setText(el.top100Sum, fmt(sum,0)); setText(el.top100Status, i18n[lang].statusUpdated); compute();
    }, function(e){ setText(el.top100Status, 'Error'); });
  }

  function compute(){
    var tge=new Date(document.getElementById('tgeDate').value||'2025-10-15');
    var days=daysBetween(today,tge); setText(el.daysToTgeNum, days);

    var g=Math.max(0, parseNum(el.growthPct.value,1.3)/100);  // 每日“增速”作为当天固定增量的比例（线性）
    var M0=parseNum(el.currentMiles.value,0);
    var d0=parseNum(el.myDailyMiles.value,0);

    // ✅ 个人：线性累计
    var myAdded = d0 * days;
    var myMilesAtTGE = M0 + myAdded;
    setText(el.myMilesAtTGE, fmt(myMilesAtTGE,2));

    var topRaw=el.top100Sum.getAttribute('data-raw')||el.top100Sum.textContent||'';
    var topSum=parseNum(topRaw,NaN);
    var shareNow=Math.max(1e-9, parseNum(el.topShare&&el.topShare.value,70)/100);
    if(el.shareLabel) el.shareLabel.textContent=(parseNum(el.topShare.value,70)||70);
    var T0=isFinite(topSum)?(topSum/shareNow):null; if(isFinite(topSum)) setText(el.totalNow, fmt(T0,0));

    var D0=parseNum(el.netDailyMilesNow.value,0);
    var T_pred=null;

    if(T0!=null){
      // ✅ 全网：全部线性，不复利
      if(D0>0){
        // 给了“全网每日新增” → 直接按固定每日新增线性累计
        T_pred = T0 + D0 * days;
      }else{
        // 没给“全网每日新增” → 用“每日增速%”折算成固定的每日新增 = T0 * g
        var dailyIncFromRate = T0 * g;
        T_pred = T0 + dailyIncFromRate * days;
      }
    }

    setText(el.T_pred, (T_pred!=null)?fmt(T_pred,0):'—');

    var fdv=parseNum(el.fdv.value,1000000000); var ap=Math.max(0, parseNum(el.airdropPct.value,8)/100); var pool=fdv*ap;
    var sharePct=T_pred?(myMilesAtTGE/T_pred):null; var myVal=(sharePct!=null)?(pool*sharePct):null;

    el.myAirdropValue.setAttribute('data-value', (myVal!=null)?('≈ $'+fmt(myVal,2)):'—');
    el.sharePct.setAttribute('data-value', (sharePct!=null)?((sharePct*100).toFixed(6)+'%'):'—');
    if(window._resultUnlocked){ setText(el.myAirdropValue, el.myAirdropValue.getAttribute('data-value')); setText(el.sharePct, el.sharePct.getAttribute('data-value')); }

    var oneM=(T_pred!=null)?(pool*(1000000/T_pred)):null; setText(el.oneMMilesValue, (oneM!=null)?('≈ $'+fmt(oneM,2)):'—');

    applyI18n(); // keep prefixes correct
  }

  function download(name, content, mime){ var blob=new Blob([content],{type:mime||'text/plain'}); var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); setTimeout(function(){URL.revokeObjectURL(a.href);},1200); }
  function exportCSV(){ var lines=[]; function add(k,v){lines.push(k+','+('"'+String(v).replace(/"/g,'""')+'"'));} add('Top100', el.top100Sum.textContent||''); add('TotalNow', el.totalNow.textContent||''); add('MyMilesAtTGE', el.myMilesAtTGE.textContent||''); add('TGE_Pred', el.T_pred.textContent||''); add('MyShare', window._resultUnlocked?(el.sharePct.getAttribute('data-value')||''):'(locked)'); add('AirdropValue', window._resultUnlocked?(el.myAirdropValue.getAttribute('data-value')||''):'(locked)'); add('OneMValue', el.oneMMilesValue.textContent||''); download('falcon_estimate.csv','\ufeff'+lines.join('\n'),'text/csv;charset=utf-8'); }

  // share with safe ASCII using unicode escapes for emojis
  function shareToTwitter(){
    var t0=(document.getElementById('totalNow')||{}).textContent||'';
    var tge=(document.getElementById('T_pred')||{}).textContent||'';
    var share=(document.getElementById('sharePct')||{}).getAttribute('data-value')||'';
    var val=(document.getElementById('myAirdropValue')||{}).getAttribute('data-value')||'';
    var site='https://menglayer.github.io/FalconAirdropEstimate/';
    var zh='\uD83D\uDE80 我的 Falcon 空投估算\n\uD83C\uDF10 全网当前≈ '+t0+'\n\uD83D\uDCC5 TGE 预计≈ '+tge+'\n\uD83D\uDCC8 我的占比≈ '+share+'\n\uD83D\uDCB0 空投价值≈ '+val+'\n\uD83D\uDD17 '+site+'\n#Falcon #Airdrop @FalconStable';
    var en='\uD83D\uDE80 My Falcon airdrop estimate\n\uD83C\uDF10 Network now ≈ '+t0+'\n\uD83D\uDCC5 TGE ≈ '+tge+'\n\uD83D\uDCC8 My share ≈ '+share+'\n\uD83D\uDCB0 Airdrop value ≈ '+val+'\n\uD83D\uDD17 '+site+'\n#Falcon #Airdrop @FalconStable';
    var text=(lang==='en')?en:zh; var url='https://twitter.com/intent/tweet?text='+encodeURIComponent(text);
    try{ window.open(url,'_blank'); }catch(e){} window._resultUnlocked=true; compute();
  }

  // events
  document.addEventListener('input', function(){ compute(); });
  document.getElementById('topShare').addEventListener('input', compute);
  if(el.refreshBtn) el.refreshBtn.addEventListener('click', fetchTop100);
  if(el.exportCsvBtn) el.exportCsvBtn.addEventListener('click', exportCSV);
  if(el.analyzeBtn) el.analyzeBtn.addEventListener('click', shareToTwitter);
  if(el.langToggle) el.langToggle.addEventListener('click', function(){ lang=(lang==='zh')?'en':'zh'; applyI18n(); });

  // init
  fetchTop100(); applyI18n(); compute();
})();
</script>
</body>
</html>
